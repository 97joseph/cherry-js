var Cherry=function(){var e=this;e.controllers=[]};Cherry.prototype.controller=function(e,t){var r=this,n=new Controller(e),a=new Scope(r,n);n.addScope(a),t(a),a.$digest()};var Controller=function(e){var t=this;t.name=e,t.scope=null};Controller.prototype.addScope=function(e){this.scope=e};var Scope=function(e,t){var r=this;r.watchers=[],r.watching=[],r.app=e,r.controller=t,r.scopeKeys=Object.keys(r),r.scopeKeys.push("scopeKeys"),r.template=new CherryTemplate(r)};Scope.prototype.$watch=function(e,t,r){var n={key:e,watchFunction:t,listenerFunction:r};this.watching.unshift(e),this.watchers.unshift(n)},Scope.prototype.$createWatcher=function(e){return function(t){return t[e]}},Scope.prototype.$init=function(){$$=this;for(var e=Object.keys($$),t=0;t<e.length;t++){var r=e[t];-1==$$.scopeKeys.indexOf(r)&&-1==$$.watching.indexOf(r)&&$$.$watch(r,$$.$createWatcher(r),function(e,t){t!==!1&&$$.template.notify(e)})}return!0},Scope.prototype.$digest=function(){if(this.$init())for(var e,t,r,n=$$.watchers.length;n--;){e=$$.watchers[n],t=e.watchFunction($$),r=e.last;var a;if(t instanceof Array&&r instanceof Array){var o=$$.compareArrays(r,t);a=!o}else a=t!==r;a&&(t instanceof Array&&(t=t.slice(0)),e.last=t,e.listenerFunction(e.key,t,r,$$))}},Scope.prototype.compareArrays=function(e,t){if(e.length!=t.length)return!1;for(var r=0;r<t.length;r++){if(e[r].compare&&!e[r].compare(t[r]))return!1;if(e[r]!==t[r])return!1}return!0},Scope.prototype.call=function(e,t){var r=this;if("undefined"!=typeof r[e]){var n=r[e].apply(null,t);return r.$digest(),n}};var CherrySelector=function(e){var t=this;t.list=[],"undefined"!=typeof e&&this.find(e)};CherrySelector.prototype.find=function(e){return this.list=document.querySelectorAll(e),this.list},CherrySelector.prototype.addClass=function(e){for(key in this.list){var t=this.list[key];t.className+=" "+e}},CherrySelector.prototype.html=function(e){for(key in this.list){if("undefined"==typeof e)return this.list[key].innerHTML;this.list[key].innerHTML=e}},CherrySelector.prototype.attr=function(e){return this.list[0].getAttribute(e)},CherrySelector.prototype.each=function(e){for(var t=0;t<this.list.length;t++)e(t,this.list[t])};var c=function(e){return new CherrySelector(e)},CherryTemplate=function(e){var t=this;t.getSection=function(e){return t.parent.find("[data-"+e+"]")},t.scope=e,t.parentSelector='[data-cherry="'+e.controller.name+'"]',t.parent=c(t.parentSelector),t.parent.addClass("cherry-watch"),t.tokenizer=new Tokenizer(t.parent),t.formatForHTML=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.notify=function(e){var r=t.formatForHTML(t.scope[e]).toString();t.tokenizer.run(),t.showTags(),t.modelTags(e,r),t.evalTags()},t.showTags=function(){c("[data-show]").each(function(e,r){var n,a=r.attr("data-show"),o=t.scopeVar[a];n="function"==typeof o?o.apply(null,[]):o,r.style.display=n===!0?"":"none"})},t.modelTags=function(e,t){var r=c('[data-var="'+e+'"], [data-model="'+e+'"]');r.each(function(e,r){"SELECT"==r.tagName||"INPUT"==r.tagName?r.value=t:r.innerHTML=t})},t.evalTags=function(){c("[data-eval]").each(function(e,r){var n=r,a=n.getAttribute("data-eval").split(" "),o=a.shift(),i=a;n.innerHTML=t.scope.call(o,i)})},t.updateModel=function(){var e=this.getAttribute("data-model");t.scope[e]=this.value,t.scope.$digest()},document.addEventListener("click",function(e){if(e.target.hasAttribute("data-click")){var r=e.target.getAttribute("data-click");t.scope.call(r)}}),document.addEventListener("keyup",function(e){e.target.hasAttribute("data-model")&&t.updateModel.call(e.target,e)}),document.addEventListener("change",function(e){e.target.hasAttribute("data-model")&&t.updateModel.call(e.target,e)})},Tokenizer=function(e){var t=this;t.el=e.list[0],t.tokenFormat=/\{\{([a-z 0-9A-Z.]*)\}\}/g,t.formats={eval:'<span class="cherry-eval" data-eval="?"></span>',"var":'<span class="cherry-var" data-var="?"></span>'}};Tokenizer.prototype.formatRawToken=function(e){return e.replace("{{","").replace("}}","")},Tokenizer.prototype.findTokens=function(e){if("undefined"==typeof e)var t=this.el;else var t=e;return"undefined"!=typeof t?t.innerHTML.match(this.tokenFormat):!1},Tokenizer.prototype.run=function(){var e=this,t=e.findTokens();if(null!=t)for(key in t){var r,n=t[key],a=e.formatRawToken(n);r=a.split(" ").length>1?e.renderEvalTag(n,a):e.renderVarTag(n,a),e.el.innerHTML=r}},Tokenizer.prototype.renderVarTag=function(e,t){var r=this;return r.el.innerHTML.replace(e,r.formats["var"].replace("?",t))},Tokenizer.prototype.renderEvalTag=function(e,t){{var r=this,n=t.split(" ");n.shift}return r.el.innerHTML.replace(e,r.formats.eval.replace("?",t))};