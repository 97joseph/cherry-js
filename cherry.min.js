var Cherry=function(){var e=this;e.controllers=[]};Cherry.prototype.controller=function(e,t){var r=this,a=new Controller(e),n=new Scope(r,a);a.addScope(n),t(n),n.$digest()};var Controller=function(e){var t=this;t.name=e,t.scope=null};Controller.prototype.addScope=function(e){this.scope=e};var Scope=function(e,t){var r=this;r.watchers=[],r.watching=[],r.app=e,r.controller=t,r.scopeKeys=Object.keys(r),r.scopeKeys.push("scopeKeys"),r.template=new CherryTemplate(r)};Scope.prototype.$watch=function(e,t,r){var a={key:e,watchFunction:t,listenerFunction:r};this.watching.unshift(e),this.watchers.unshift(a)},Scope.prototype.$createWatcher=function(e){return function(t){return t[e]}},Scope.prototype.$init=function(){$$=this;for(var e=Object.keys($$),t=0;t<e.length;t++){var r=e[t];-1==$$.scopeKeys.indexOf(r)&&-1==$$.watching.indexOf(r)&&$$.$watch(r,$$.$createWatcher(r),function(e,t){t!==!1&&$$.template.notify(e)})}return!0},Scope.prototype.$digest=function(){if(this.$init())for(var e,t,r,a=$$.watchers.length;a--;){e=$$.watchers[a],t=e.watchFunction($$),r=e.last;var n;if(t instanceof Array&&r instanceof Array){var o=$$.compareArrays(r,t);n=!o}else n=t!==r;n&&(t instanceof Array&&(t=t.slice(0)),e.last=t,e.listenerFunction(e.key,t,r,$$))}},Scope.prototype.compareArrays=function(e,t){if(e.length!=t.length)return!1;for(var r=0;r<t.length;r++){if(e[r].compare&&!e[r].compare(t[r]))return!1;if(e[r]!==t[r])return!1}return!0},Scope.prototype.call=function(e,t){var r=this;if("undefined"!=typeof r[e]){var a=r[e].apply(null,t);return r.$digest(),a}};var CherrySelector=function(e){var t=this;t.list=[],"undefined"!=typeof e&&this.find(e)};CherrySelector.prototype.find=function(e){return this.list=document.querySelectorAll(e),this.list},CherrySelector.prototype.addClass=function(e){for(key in this.list){var t=this.list[key];t.className+=" "+e}},CherrySelector.prototype.html=function(e){for(key in this.list){if("undefined"==typeof e)return this.list[key].innerHTML;this.list[key].innerHTML=e}},CherrySelector.prototype.attr=function(e){return this.list[0].getAttribute(e)},CherrySelector.prototype.each=function(e){for(var t=0;t<this.list.length;t++)e(t,this.list[t])};var c=function(e){return new CherrySelector(e)},CherryTemplate=function(e){var t=this;t.scope=e,t.parentSelector='[data-cherry="'+e.controller.name+'"]',t.parent=c(t.parentSelector),t.parent.addClass("cherry-watch"),t.tokenizer=new Tokenizer(t.parent),t.formatForHTML=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.notify=function(e){var r=t.formatForHTML(t.scope[e]).toString();t.tokenizer.run(),t.repeatTags(),t.showTags(),t.modelTags(e,r),t.evalTags()},t.repeatTags=function(){var e=this;c("[data-repeat]").each(function(t,r){for(var a=r.parentNode.querySelectorAll("[data-repeater]"),n=0;n<a.length;n++){var o=a[n];o.parentNode.removeChild(o)}var i=r.getAttribute("data-repeat").split(" in "),c=e.scope[i[1]];for(key in c){var l=r.cloneNode(!0);l.style.display="",l.removeAttribute("data-repeat"),l.setAttribute("data-repeater",key),r.parentNode.appendChild(l),e.repeatTagChildren(l)}r.style.display="none"})},t.repeatTagChildren=function(e){for(var r=e.querySelectorAll("[data-repeat-child]"),a=0;a<r.length;a++){var n=r[a],o=n.getAttribute("data-repeat-child"),c=n.getAttribute("data-key"),l=n.parentNode.getAttribute("data-repeater"),s=t.scope[o][parseInt(l)];if(c.split(".").length>1){s=t.scope[o][parseInt(l)],keys=c.split("."),keys.shift();for(i in keys)s=s[keys[i]]}var p=document.createTextNode(s);n.parentNode.appendChild(p),n.parentNode.removeChild(n)}},t.showTags=function(){c("[data-show]").each(function(e,r){var a,n=r.getAttribute("data-show"),o=t.scope[n];a="function"==typeof o?o.apply(null,[]):o,r.style.display=a===!0?"":"none"})},t.modelTags=function(e,t){var r=c('[data-var="'+e+'"], [data-model="'+e+'"]');r.each(function(e,r){"SELECT"==r.tagName||"INPUT"==r.tagName?r.value=t:r.innerHTML=t})},t.evalTags=function(){c("[data-eval]").each(function(e,r){var a=r,n=a.getAttribute("data-eval").split(" "),o=n.shift(),i=n;a.innerHTML=t.scope.call(o,i)})},t.updateModel=function(){var e=this.getAttribute("data-model");t.scope[e]=this.value,t.scope.$digest()},document.addEventListener("click",function(e){if(e.target.hasAttribute("data-click")){var r=e.target,a=e.target.getAttribute("data-click");if(null!=r.getAttribute("data-arguments"))var n=r.getAttribute("data-arguments").split(",");else var n=[];t.scope.call(a,n)}}),document.addEventListener("keyup",function(e){e.target.hasAttribute("data-model")&&t.updateModel.call(e.target,e)}),document.addEventListener("change",function(e){e.target.hasAttribute("data-model")&&t.updateModel.call(e.target,e)})},Tokenizer=function(e){var t=this;t.el=e.list[0],t.tokenFormat=/\{\{([a-z 0-9A-Z.]*)\}\}/g,t.formats={eval:'<span class="cherry-eval" data-eval="?"></span>',"var":'<span class="cherry-var" data-var="?"></span>',repeat:'<span class="cherry-repeat-child" data-repeat-child="?" data-key="@"></span>'}};Tokenizer.prototype.formatRawToken=function(e){return e.replace("{{","").replace("}}","")},Tokenizer.prototype.findTokens=function(e){if("undefined"==typeof e)var t=this.el;else var t=e;return"undefined"!=typeof t?t.innerHTML.match(this.tokenFormat):!1},Tokenizer.prototype.run=function(){var e=this;e.renderRepeatTags();var t=e.findTokens();if(null!=t)for(key in t){var r,a=t[key],n=e.formatRawToken(a);r=n.split(" ").length>1?e.renderEvalTag(a,n):e.renderVarTag(a,n),e.el.innerHTML=r}},Tokenizer.prototype.renderRepeatTags=function(){var e=this;c("[data-repeat]").each(function(t,r){var a=e.findTokens(r),n=r.getAttribute("data-repeat").split(" in "),o=n[1];for(key in a){var i,c=a[key],l=e.formatRawToken(c);i=r.innerHTML.replace(c,e.formats.repeat.replace("?",o).replace("@",l)),r.innerHTML=i}})},Tokenizer.prototype.renderVarTag=function(e,t){var r=this;return r.el.innerHTML.replace(e,r.formats["var"].replace("?",t))},Tokenizer.prototype.renderEvalTag=function(e,t){{var r=this,a=t.split(" ");a.shift}return r.el.innerHTML.replace(e,r.formats.eval.replace("?",t))};